<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
</head>
<body>
  <div  id="donations">
    <span id="noDonations"> No donation data yet. </span>

    <div id="recentDonations" class="list-group">
    </div>

    <a rv-href="otherData.donationsLink">And { otherData.remainder } others</a>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/rivets/0.8.1/rivets.bundled.min.js" type="text/javascript"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/numeral.js/1.4.5/numeral.min.js"></script>
  <script>
    // 'use strict';
    //
    // var extraLifeId = nodecg.Replicant('extralife-id', { defaultValue: '' });
    // var donations = nodecg.Replicant('donations', { defaultValue: [] });
    // var wrapper = {
    //   remainder: 0,
    //   donationsLink: 'http://www.extra-life.org/index.cfm?fuseaction=donordrive.participantDonations&participantID=' + extraLifeId.value
    // };
    // var numDisplayed = 0;
    // var lastSeenDonation = null;
    // var anyDonations = false;
    // var pollInterval = (30 * 10);
    // var initial = true;
    //
    // extraLifeId.on('change', function(oldValue, newValue) {
    //   wrapper.donationsLink = 'http://www.extra-life.org/index.cfm?fuseaction=donordrive.participantDonations&participantID=' + newValue;
    // });
    //
    // rivets.bind($('#donations'), { anyDonations: anyDonations, otherData: wrapper });
    //
    // donations.on('change', function(oldValue, newValue) {
    //   if (!newValue) {
    //     return;
    //   }
    //
    //   var newArray = newValue.array;
    //   if (!Array.isArray(newArray)) {
    //     console.log('not an array');
    //     return;
    //   }
    //
    //   if (newArray.length === 0 || newValue.clear) {
    //     $('#recentDonations').children().remove();
    //     lastSeenDonation = null;
    //     numDisplayed = 0;
    //     initial = true;
    //   }
    //
    //   $('#noDonations').remove();
    //
    //   var pass = false;
    //   var temporary = [];
    //   for(var i = newArray.length -1; i>= 0; i--) {
    //     var donation = newArray[i];
    //     if (donation.id === lastSeenDonation || pass) {
    //       pass = true;
    //       continue;
    //     } else {
    //       temporary.unshift(donation);
    //     }
    //   };
    //
    //   temporary.forEach(function(donation) {
    //     numDisplayed++;
    //
    //     $('<a href="#" style="display: none;" class="list-group-item">' +
    //       '<h4 class="list-group-item-heading" style="float: left;">' + (donation.displayName || 'Anonymous') + (donation.amount ? (' - ' + donation.amount) : '' ) + '</h4>' +
    //       '<p class="list-group-item-heading" style="float: right;">' + donation.createdDateUTC + '</p>' +
    //       '<p class="list-group-item-text" style="clear: both;">' + (donation.message || '') + '</p>' +
    //       '</a>').prependTo('#recentDonations').fadeIn();
    //
    //     if (numDisplayed >= 21) {
    //       $('#recentDonations').children().last().remove();
    //     }
    //   });
    //
    //   initial = false;
    //   lastSeenDonation = newArray.length > 0 ? newArray[newArray.length - 1].id : null;
    //
    //   wrapper.remainder = newArray.length > 20 ? newArray.length - 20 : 0;
    // });
  </script>
</body>
</html>
